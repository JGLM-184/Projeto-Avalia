<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prévia da Prova</title>

    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	
	<link rel="icon" type="image/png" href="/imagens/logo.png">
</head>
<body class="coordinator-layout">

    <!-- Navbar -->
    <div th:replace="~{navbar :: navbar}"></div>

    <main class="main-content">
        <div class="container-fluid">

            <!-- Botão Voltar -->
            <div class="row mb-3 no-print">
                <div class="col-12">
                    <a th:href="@{'/provas/editar/' + ${provaId}}" class="btn btn-outline-secondary">
                        <span class="material-icons">arrow_back</span>
                        Voltar para edição
                    </a>
                </div>
            </div>

            <!-- Prévia -->
            <div class="pdf-preview" id="pdfPreview">

                <!-- Cabeçalho -->
                <div class="pdf-header">
                    <div class="pdf-title" th:text="${titulo}">TÍTULO DA PROVA</div>
                    <div class="pdf-subtitle">CENTRO PAULA SOUZA</div>
                    <div class="pdf-subtitle">FACULDADE DE TECNOLOGIA</div>

                    <div class="pdf-info-grid">

                        <div class="pdf-info-item">
                            <span class="pdf-info-label">Professor:</span>
                            <div class="pdf-info-value" th:text="${professor.nome}">Professor</div>
                        </div>

                        <div class="pdf-info-item">
                            <span class="pdf-info-label" th:text="${disciplinas.size() > 1 ? 'Disciplinas:' : 'Disciplina:'}">Disciplina:</span>
                            <div class="pdf-info-value">
                                <span th:each="disciplina, iter : ${disciplinas}"
                                      th:text="${disciplina.nome} + ' '"></span>
                            </div>
                        </div>

                        <div class="pdf-info-item">
                            <span class="pdf-info-label">Nome do Aluno:</span>
                            <div class="pdf-info-value"> </div>
                        </div>

                        <div class="pdf-info-item">
                            <span class="pdf-info-label">Data:</span>
                            <div class="pdf-info-value">_____/______/____________</div>
                        </div>

                    </div>
                </div>
                
				<!-- GABARITO PARA O ALUNO -->
				<div class="pdf-answer-sheet">
				    <h4 class="text-center mb-3">Gabarito</h4>
				
				    <table class="pdf-answer-table">
				        <thead>
				            <tr>
				                <th>Questão</th>
				                <th>A</th>
				                <th>B</th>
				                <th>C</th>
				                <th>D</th>
				                <th>E</th>
				            </tr>
				        </thead>
				        <tbody>
				            <tr th:each="questao, iter : ${questoes}">
				                <td th:text="${iter.count}"></td>
				                <td></td>
				                <td></td>
				                <td></td>
				                <td></td>
				                <td></td>
				            </tr>
				        </tbody>
				    </table>
				</div>

                <!-- Questões -->
                <div class="pdf-questions">

                    <div th:if="${#lists.isEmpty(questoes)}" class="text-center py-4 text-muted">
                        Nenhuma questão foi adicionada à prova.
                    </div>

                    <div th:each="questao, iter : ${questoes}" class="pdf-question">

                        <div class="pdf-question">
                        	<span class="pdf-question-number" th:utext="${iter.count} + ') '"></span>
                            <span class="pdf-question-text" th:utext="${questao.questao.enunciado}"></span>
                        </div>

                        <!-- Imagem (se existir) -->
                        <div th:if="${questao.questao.imagem != null}" class="pdf-question-image">
                            <img th:src="${questao.questao.imagem}" style="max-width: 200px;">
                        </div>

                        <!-- Alternativas -->
                        <div class="pdf-alternatives" th:if="${questao.questao.alternativas != null}">
                            <div th:each="alternativa, iter : ${questao.questao.alternativas}" class="pdf-alternative">
                                <div class="pdf-alternative-letter"
							         th:text="'( ' + ${'ABCDE'.substring(iter.count - 1, iter.count)} + ' )'">
							    </div>
                                <div class="pdf-alternative-text" th:utext="${alternativa.texto}"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- fim do preview -->

        </div>
        <!-- Ações Inferiores Flutuantes -->
        <div class="preview-actions no-print">
			<button class="btn btn-normal no-print" data-bs-toggle="modal" data-bs-target="#modalGabarito">
			    Gabarito
			</button>
            <button class="btn btn-normal me-2">
                <span class="material-icons" style="font-size:16px;">print</span>
                Imprimir
            </button>
            <button class="btn btn-danger me-2">
                <span class="material-icons" style="font-size:16px;">picture_as_pdf</span>
                PDF
            </button>
			<a th:href="@{'/provas/detalhes/' + ${provaId} + '?embaralhar=true'}" 
			   class="btn btn-success">
			    <span class="material-icons" style="font-size:16px;">shuffle</span>
			    Embaralhar
			</a>
			
        </div>
    </main>
    
    <!-- Modal Gabarito -->
	<div class="modal fade" id="modalGabarito" tabindex="-1" aria-labelledby="modalGabaritoLabel" aria-hidden="true">
	  <div class="modal-dialog modal-lg modal-dialog-centered">
	    <div class="modal-content">
	      
	      <div class="modal-header">
	        <h5 class="modal-title" id="modalGabaritoLabel">Gabarito da Prova</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	
	      <div class="modal-body">
	        
	        <!-- Exemplo de tabela de gabarito -->
	        <table class="table table-bordered text-center">
	            <thead>
	                <tr>
	                    <th>Questão</th>
	                    <th>Resposta</th>
	                </tr>
	            </thead>
			<tbody>
			    <tr th:each="questao, iter : ${questoes}">
			        <td th:text="${iter.count}"></td>
			
			        <!-- Exibir letra da alternativa correta -->
			        <td>
			            <span th:each="alt, iter : ${questao.questao.alternativas}"
			                  th:if="${alt.isCorreto()}">
			                <span th:text="${iter.count == 1 ? 'A' : 
			                				 iter.count == 2 ? 'B' : 
			                				 iter.count == 3 ? 'C' :
			                				 iter.count == 4 ? 'D' : 'E'}"></span>
			            </span>
			        </td>
			    </tr>
			</tbody>

	        </table>
	
	      </div>
	
	      <div class="modal-footer">
	        <button class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
	      </div>
	
	    </div>
	  </div>
	</div>
	    
</body>
</html>