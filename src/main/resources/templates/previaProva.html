<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prévia da Prova</title>

    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        .pdf-preview {
            background: white;
            min-height: 100vh;
            padding: 40px;
            font-family: 'Times New Roman', Times, serif;
            line-height: 1.4;
            max-width: 1000px;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .pdf-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #000;
            padding-bottom: 20px;
        }

        .pdf-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .pdf-subtitle {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .pdf-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 25px 0;
            font-size: 12px;
        }

        .pdf-info-item {
            display: flex;
            flex-direction: column;
        }

        .pdf-info-label {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .pdf-info-value {
            border-bottom: 1px solid #000;
            padding: 2px 0;
            min-height: 18px;
        }

        .pdf-questions {
            margin-top: 30px;
        }

        .pdf-question {
            margin-bottom: 25px;
            page-break-inside: avoid;
        }

        .pdf-question-number {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .pdf-question-text {
            margin-bottom: 12px;
            text-align: justify;
        }

        .pdf-alternatives {
            margin-left: 20px;
        }

        .pdf-alternative {
            margin-bottom: 5px;
            display: flex;
            align-items: flex-start;
        }

        .pdf-alternative-letter {
            font-weight: bold;
            margin-right: 8px;
            min-width: 20px;
        }

        .pdf-alternative-text {
            flex: 1;
        }

        .pdf-question-image {
            text-align: center;
            margin: 10px 0;
            font-style: italic;
            color: #666;
            border: 1px dashed #ccc;
            padding: 10px;
        }

        .pdf-footer {
            margin-top: 40px;
            text-align: center;
            font-size: 11px;
            color: #666;
            border-top: 1px solid #ccc;
            padding-top: 10px;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .pdf-preview, .pdf-preview * {
                visibility: visible;
            }
            .pdf-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
                margin: 0;
                box-shadow: none;
            }
            .no-print {
                display: none !important;
            }
        }

        .preview-actions {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .pdf-answer-sheet {
		    margin-top: 30px;
		    margin-bottom: 40px;
		}
		
		.pdf-answer-table {
		    width: 100%;
		    border-collapse: collapse;
		    font-size: 13px;
		}
		
		.pdf-answer-table th,
		.pdf-answer-table td {
		    border: 1px solid #000;
		    text-align: center;
		    padding: 6px 0;
		    width: 40px;
		}
		
		.pdf-answer-table th:first-child,
		.pdf-answer-table td:first-child {
		    width: 70px; /* Coluna do número da questão */
		    font-weight: bold;
		}
		
		.pdf-answer-table td {
		    height: 22px; /* Espaço para o aluno colocar um X */
		}
		        
    </style>
</head>
<body class="coordinator-layout">

    <!-- Navbar -->
    <div th:replace="~{navbar :: navbar}"></div>

    <main class="main-content">
        <div class="container-fluid">

            <!-- Botão Voltar -->
            <div class="row mb-3 no-print">
                <div class="col-12">
                    <a th:href="@{'/provas/editar/' + ${provaId}}" class="btn btn-outline-secondary">
                        <span class="material-icons">arrow_back</span>
                        Voltar para edição
                    </a>
                </div>
            </div>

            <!-- Prévia -->
            <div class="pdf-preview" id="pdfPreview">

                <!-- Cabeçalho -->
                <div class="pdf-header">
                    <div class="pdf-title" th:text="${titulo}">TÍTULO DA PROVA</div>
                    <div class="pdf-subtitle">CENTRO PAULA SOUZA</div>
                    <div class="pdf-subtitle">FACULDADE DE TECNOLOGIA</div>

                    <div class="pdf-info-grid">

                        <div class="pdf-info-item">
                            <span class="pdf-info-label">Professor:</span>
                            <div class="pdf-info-value" th:text="${professor.nome}">Professor</div>
                        </div>

                        <div class="pdf-info-item">
                            <span class="pdf-info-label" th:text="${disciplinas.size() > 1 ? 'Disciplinas:' : 'Disciplina:'}">Disciplina:</span>
                            <div class="pdf-info-value">
                                <span th:each="disciplina, iter : ${disciplinas}"
                                      th:text="${disciplina.nome} + ' '"></span>
                            </div>
                        </div>

                        <div class="pdf-info-item">
                            <span class="pdf-info-label">Nome do Aluno:</span>
                            <div class="pdf-info-value"> </div>
                        </div>

                        <div class="pdf-info-item">
                            <span class="pdf-info-label">Data:</span>
                            <div class="pdf-info-value">_____/______/____________</div>
                        </div>

                    </div>
                </div>
                
				<!-- GABARITO PARA O ALUNO -->
				<div class="pdf-answer-sheet">
				    <h4 class="text-center mb-3">Gabarito</h4>
				
				    <table class="pdf-answer-table">
				        <thead>
				            <tr>
				                <th>Questão</th>
				                <th>A</th>
				                <th>B</th>
				                <th>C</th>
				                <th>D</th>
				                <th>E</th>
				            </tr>
				        </thead>
				        <tbody>
				            <tr th:each="questao, iter : ${questoes}">
				                <td th:text="${iter.count}"></td>
				                <td></td>
				                <td></td>
				                <td></td>
				                <td></td>
				                <td></td>
				            </tr>
				        </tbody>
				    </table>
				</div>

                <!-- Questões -->
                <div class="pdf-questions">

                    <div th:if="${#lists.isEmpty(questoes)}" class="text-center py-4 text-muted">
                        Nenhuma questão foi adicionada à prova.
                    </div>

                    <div th:each="questao, iter : ${questoes}" class="pdf-question">

                        <div class="pdf-question">
                        	<span class="pdf-question-number" th:utext="${iter.count} + ') '"></span>
                            <span class="pdf-question-text" th:utext="${questao.questao.enunciado}"></span>
                        </div>

                        <!-- Imagem (se existir) -->
                        <div th:if="${questao.questao.imagem != null}" class="pdf-question-image">
                            <img th:src="${questao.questao.imagem}" style="max-width: 200px;">
                        </div>

                        <!-- Alternativas -->
                        <div class="pdf-alternatives" th:if="${questao.questao.alternativas != null}">
                            <div th:each="alternativa, iter : ${questao.questao.alternativas}" class="pdf-alternative">
                                <div class="pdf-alternative-letter"
							         th:text="'( ' + ${'ABCDE'.substring(iter.count - 1, iter.count)} + ' )'">
							    </div>
                                <div class="pdf-alternative-text" th:utext="${alternativa.texto}"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- fim do preview -->

        </div>
        <!-- Ações Inferiores Flutuantes -->
        <div class="preview-actions no-print">
			<button class="btn btn-danger no-print" data-bs-toggle="modal" data-bs-target="#modalGabarito">
			    Gabarito
			</button>
            <button class="btn btn-success me-2">
                <span class="material-icons" style="font-size:16px;">print</span>
                Imprimir
            </button>
            <button class="btn btn-danger me-2">
                <span class="material-icons" style="font-size:16px;">picture_as_pdf</span>
                PDF
            </button>
			<a th:href="@{'/provas/detalhes/' + ${provaId} + '?embaralhar=true'}" 
			   class="btn btn-success">
			    <span class="material-icons" style="font-size:16px;">shuffle</span>
			    Embaralhar
			</a>
			
        </div>
    </main>
    
    <!-- Modal Gabarito -->
	<div class="modal fade" id="modalGabarito" tabindex="-1" aria-labelledby="modalGabaritoLabel" aria-hidden="true">
	  <div class="modal-dialog modal-lg modal-dialog-centered">
	    <div class="modal-content">
	      
	      <div class="modal-header">
	        <h5 class="modal-title" id="modalGabaritoLabel">Gabarito da Prova</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	
	      <div class="modal-body">
	        
	        <!-- Exemplo de tabela de gabarito -->
	        <table class="table table-bordered text-center">
	            <thead>
	                <tr>
	                    <th>Questão</th>
	                    <th>Resposta</th>
	                </tr>
	            </thead>
			<tbody>
			    <tr th:each="questao, iter : ${questoes}">
			        <td th:text="${iter.count}"></td>
			
			        <!-- Exibir letra da alternativa correta -->
			        <td>
			            <span th:each="alt, iter : ${questao.questao.alternativas}"
			                  th:if="${alt.isCorreto()}">
			                <span th:text="${iter.count == 1 ? 'A' : 
			                				 iter.count == 2 ? 'B' : 
			                				 iter.count == 3 ? 'C' :
			                				 iter.count == 4 ? 'D' : 'E'}"></span>
			            </span>
			        </td>
			    </tr>
			</tbody>

	        </table>
	
	      </div>
	
	      <div class="modal-footer">
	        <button class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
	      </div>
	
	    </div>
	  </div>
	</div>
	    
</body>
</html>